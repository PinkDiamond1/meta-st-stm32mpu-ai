From 0c068f2d448dfff56adba8f4738a353cd8d70f98 Mon Sep 17 00:00:00 2001
From: Vincent ABRIOU <vincent.abriou@st.com>
Date: Thu, 17 Mar 2022 10:27:59 +0100
Subject: [PATCH 4/5] TFLite: add SONAME with MAJOR version

Signed-off-by: Vincent ABRIOU <vincent.abriou@st.com>
---
 tensorflow/lite/CMakeLists.txt                               | 5 +++++
 .../lite/tools/pip_package/build_pip_package_with_cmake.sh   | 1 +
 2 files changed, 6 insertions(+)

diff --git a/tensorflow/lite/CMakeLists.txt b/tensorflow/lite/CMakeLists.txt
index 83736e8d813..daf3bffadd1 100644
--- a/tensorflow/lite/CMakeLists.txt
+++ b/tensorflow/lite/CMakeLists.txt
@@ -559,6 +559,11 @@ target_compile_options(_pywrap_tensorflow_interpreter_wrapper
 add_library(tensorflow-lite SHARED EXCLUDE_FROM_ALL
   ${TFLITE_SOURCE_DIR}/examples/minimal/minimal.cc
 )
+
+# To add SONAME with the MAJOR
+message("TFLITE_VERSION_MAJOR=${TFLITE_VERSION_MAJOR}")
+set_target_properties(tensorflow-lite PROPERTIES VERSION "${TFLITE_VERSION_MAJOR}")
+
 target_include_directories(tensorflow-lite
   PUBLIC
     ${TFLITE_INCLUDE_DIRS}
diff --git a/tensorflow/lite/tools/pip_package/build_pip_package_with_cmake.sh b/tensorflow/lite/tools/pip_package/build_pip_package_with_cmake.sh
index bdd3bee1675..0d57bb0f1a9 100755
--- a/tensorflow/lite/tools/pip_package/build_pip_package_with_cmake.sh
+++ b/tensorflow/lite/tools/pip_package/build_pip_package_with_cmake.sh
@@ -76,6 +76,7 @@ case "${TENSORFLOW_TARGET}" in
       -DTFLITE_ENABLE_XNNPACK=OFF \
       -DCMAKE_SYSTEM_NAME=Linux \
       -DCMAKE_SYSTEM_PROCESSOR=${TENSORFLOW_TARGET_ARCH} \
+      -DTFLITE_VERSION_MAJOR=${TFLITE_VERSION_MAJOR} \
       "${TENSORFLOW_LITE_DIR}"
     ;;
   armhf)
-- 
2.17.1

